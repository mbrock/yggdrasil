// Generated by CoffeeScript 1.4.0
(function() {

  $(function() {
    var addNode, makeLeafElement, makeReplyFunction, nodes, renderTree, socket;
    makeReplyFunction = function(id) {
      return function() {
        var content;
        content = window.prompt('Reply', 'Write your reply');
        return $.ajax({
          type: 'PUT',
          url: "/" + id,
          data: content
        });
      };
    };
    nodes = {};
    addNode = function(id, parentId, content) {
      var element, parent;
      parent = nodes[parentId];
      element = makeLeafElement(id, content);
      nodes[id] = {
        element: element
      };
      return parent.element.append(element);
    };
    makeLeafElement = function(id, content) {
      return $('<div/>').addClass('node').append($('<div/>').addClass('controls').append($('<a href="#"/>').text('⤸').click(makeReplyFunction(id)))).append($('<div/>').addClass('content').text(content)).append($('<div/>').addClass('branches'));
    };
    nodes['0'] = {
      element: makeLeafElement(0, '')
    };
    $("body").append(nodes[0].element);
    renderTree = function(tree) {
      return $('<div/>').addClass('node').append($('<div/>').addClass('controls').append($('<a href="#"/>').text('⤸').click(makeReplyFunction(tree)))).append($('<div/>').addClass('content').text(tree.content)).append($('<div/>').addClass('branches').append([
        (function() {
          var _i, _len, _ref, _results;
          _ref = tree.branches;
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            tree = _ref[_i];
            _results.push(renderTree(tree)[0]);
          }
          return _results;
        })()
      ]));
    };
    socket = new WebSocket("ws://" + location.hostname + ":9160");
    return socket.onopen = function(event) {
      return socket.onmessage = function(event) {
        var content, id, parentId, _ref;
        _ref = JSON.parse(event.data), id = _ref[0], parentId = _ref[1], content = _ref[2];
        return addNode(id, parentId, content);
      };
    };
  });

}).call(this);
