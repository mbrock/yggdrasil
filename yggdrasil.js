// Generated by CoffeeScript 1.4.0
(function() {

  $(function() {
    var addNode, makeLeafElement, makeReplyFunction, nodes;
    makeReplyFunction = function(id) {
      return function() {
        var content;
        content = window.prompt('Reply', 'Write your reply');
        if (content != null) {
          $.ajax({
            type: 'PUT',
            url: "/" + id,
            data: content
          });
        }
        return false;
      };
    };
    nodes = {};
    addNode = function(id, parentId, content) {
      var element, parent;
      parent = nodes[parentId];
      element = makeLeafElement(id, content);
      nodes[id] = {
        element: element
      };
      return parent.element.append(element);
    };
    makeLeafElement = function(id, content) {
      return $('<div/>').addClass('node').append($('<div/>').addClass('controls').append($('<a href="#"/>').text('â¤¸').click(makeReplyFunction(id)))).append($('<div/>').addClass('content').text(content)).append($('<div/>').addClass('branches'));
    };
    nodes['0'] = {
      element: makeLeafElement(0, '')
    };
    $("body").append(nodes[0].element);
    return $.getJSON("/history", function(data) {
      var event, socket, _i, _len;
      for (_i = 0, _len = data.length; _i < _len; _i++) {
        event = data[_i];
        addNode.apply(null, event);
      }
      socket = new WebSocket("ws://" + location.hostname + ":8080");
      return socket.onopen = function(event) {
        return socket.onmessage = function(event) {
          return addNode.apply(null, JSON.parse(event.data));
        };
      };
    });
  });

}).call(this);
